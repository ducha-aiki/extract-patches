---

title: core

keywords: fastai
sidebar: home_sidebar

summary: "API details."
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/core.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_patches" class="doc_header"><code>extract_patches</code><a href="https://github.com/ducha-aiki/extract_patches/tree/master/extract_patches/core.py#L10" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_patches</code>(<strong><code>kpts</code></strong>, <strong><code>img</code></strong>, <strong><code>PS</code></strong>=<em><code>32</code></em>, <strong><code>mag_factor</code></strong>=<em><code>10.0</code></em>, <strong><code>input_format</code></strong>=<em><code>'cv2'</code></em>)</p>
</blockquote>
<p>Extracts patches given the keypoints in the one of the following formats:</p>
<ul>
<li>cv2: list of cv2 keypoints</li>
<li>cv2+A: tuple of (list of cv2 keypoints, Nx2x2 np array)</li>
<li>ellipse: Nx5 np array, single row is [x y a b c]</li>
<li>xyA: Nx6 np array, single row is [x y a11 a12 a21 a22]</li>
<li>LAF: Nx2x3 np array, single row is [a11 a12 x; a21 a22 y]
Returns list of patches.
Upgraded version of
mag_factor is a scale coefficient. Use 10 for extracting OpenCV SIFT patches, 1.0 for OpenCV ORB patches, etc
PS is the output patch size in pixels</li>
</ul>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="build_image_pyramid" class="doc_header"><code>build_image_pyramid</code><a href="https://github.com/ducha-aiki/extract_patches/tree/master/extract_patches/core.py#L44" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>build_image_pyramid</code>(<strong><code>img</code></strong>, <strong><code>min_size</code></strong>)</p>
</blockquote>
<p>Builds image pyramid</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_patches_Ms" class="doc_header"><code>extract_patches_Ms</code><a href="https://github.com/ducha-aiki/extract_patches/tree/master/extract_patches/core.py#L58" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_patches_Ms</code>(<strong><code>Ms</code></strong>, <strong><code>img</code></strong>, <strong><code>pyr_idxs</code></strong>=<em><code>[]</code></em>, <strong><code>PS</code></strong>=<em><code>32</code></em>)</p>
</blockquote>
<p>Builds image pyramid and rectifies patches around keypoints
in the tranformation matrix format
from the appropriate level of image pyramid,
removing high freq artifacts. Border mode is set to "replicate",
so the boundary patches don`t have crazy black borders
Returns list of patches.
Upgraded version of
<a href="https://github.com/vbalnt/tfeat/blob/master/tfeat_utils.py">https://github.com/vbalnt/tfeat/blob/master/tfeat_utils.py</a></p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="convert_cv2_keypoints" class="doc_header"><code>convert_cv2_keypoints</code><a href="https://github.com/ducha-aiki/extract_patches/tree/master/extract_patches/core.py#L82" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>convert_cv2_keypoints</code>(<strong><code>kps</code></strong>, <strong><code>PS</code></strong>, <strong><code>mag_factor</code></strong>)</p>
</blockquote>
<p>Converts OpenCV keypoints into transformation matrix
and pyramid index to extract from for the patch extraction</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="convert_cv2_plus_A_keypoints" class="doc_header"><code>convert_cv2_plus_A_keypoints</code><a href="https://github.com/ducha-aiki/extract_patches/tree/master/extract_patches/core.py#L106" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>convert_cv2_plus_A_keypoints</code>(<strong><code>kps</code></strong>, <strong><code>A</code></strong>, <strong><code>PS</code></strong>, <strong><code>mag_factor</code></strong>)</p>
</blockquote>
<p>Converts OpenCV keypoints + A [n x 2 x 2] affine shape
into transformation matrix
and pyramid index to extract from for the patch extraction</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="convert_xyA" class="doc_header"><code>convert_xyA</code><a href="https://github.com/ducha-aiki/extract_patches/tree/master/extract_patches/core.py#L136" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>convert_xyA</code>(<strong><code>kps</code></strong>, <strong><code>PS</code></strong>, <strong><code>mag_factor</code></strong>)</p>
</blockquote>
<p>Converts n x [x y a11 a12 a21 a22] affine regions
into transformation matrix
and pyramid index to extract from for the patch extraction</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="convert_LAFs" class="doc_header"><code>convert_LAFs</code><a href="https://github.com/ducha-aiki/extract_patches/tree/master/extract_patches/core.py#L159" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>convert_LAFs</code>(<strong><code>kps</code></strong>, <strong><code>PS</code></strong>, <strong><code>mag_factor</code></strong>)</p>
</blockquote>
<p>Converts n x [ a11 a12 x; a21 a22 y] affine regions
into transformation matrix
and pyramid index to extract from for the patch extraction</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Ell2LAF" class="doc_header"><code>Ell2LAF</code><a href="https://github.com/ducha-aiki/extract_patches/tree/master/extract_patches/core.py#L182" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Ell2LAF</code>(<strong><code>ell</code></strong>)</p>
</blockquote>
<p>Converts ellipse [x y a b c] into [ a11 a12 x; a21 a22 y] affine region</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="invSqrt" class="doc_header"><code>invSqrt</code><a href="https://github.com/ducha-aiki/extract_patches/tree/master/extract_patches/core.py#L199" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>invSqrt</code>(<strong><code>a</code></strong>, <strong><code>b</code></strong>, <strong><code>c</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="rectifyAffineTransformationUpIsUp" class="doc_header"><code>rectifyAffineTransformationUpIsUp</code><a href="https://github.com/ducha-aiki/extract_patches/tree/master/extract_patches/core.py#L225" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>rectifyAffineTransformationUpIsUp</code>(<strong><code>A</code></strong>)</p>
</blockquote>
<p>Sets [ a11 a12; a21 a22] into upright orientation</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="convert_ellipse_keypoints" class="doc_header"><code>convert_ellipse_keypoints</code><a href="https://github.com/ducha-aiki/extract_patches/tree/master/extract_patches/core.py#L238" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>convert_ellipse_keypoints</code>(<strong><code>ells</code></strong>, <strong><code>PS</code></strong>, <strong><code>mag_factor</code></strong>)</p>
</blockquote>
<p>Converts n x [ x y a b c] affine regions
into transformation matrix
and pyramid index to extract from for the patch extraction</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nbdev.export</span> <span class="k">import</span> <span class="o">*</span>
<span class="n">notebook2script</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Converted core.ipynb.
Converted index.ipynb.
</pre>
</div>
</div>

</div>
</div>

</div>
</div>
 

